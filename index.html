<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Variable Speed Fireworks and Heart Animation</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const CANVAS_CENTER_X = canvas.width / 2;
const CANVAS_CENTER_Y = canvas.height / 2;
const IMAGE_ENLARGE = 12;
const HEART_COLOR = 'pink';

class Firework {
    constructor(color, speed, width, height) {
        this.radius = Math.random() * 2 + 2;
        this.color = color;
        this.speed = speed;
        this.status = 0;
        this.scaleSpeed = Math.random() * 0.03 + 0.01; // 控制绽放速度的变量
        this.nParticle = Math.random() * 20 + 80;
        this.center = [
            Math.random() * (width - 30) + 15,
            Math.random() * (height - 30) + 15
        ];
        this.particles = [];
        const theta = (2 * Math.PI) / this.nParticle;
        for (let i = 0; i < this.nParticle; i++) {
            const t = Math.random() * 2 * Math.PI;
            const x = 30 * Math.cos(theta * i + t);
            const y = 20 * Math.sin(theta * i + t);
            this.particles.push([x, y]);
        }
    }

    update() {
        this.status += this.scaleSpeed; // 通过 scaleSpeed 控制绽放速度
        if (this.status >= 1) this.status = 1; // 确保不会超过最大状态
        for (let i = 0; i < this.particles.length; i++) {
            const [x, y] = this.particles[i];
            const scale = this.status;
            const drawX = this.center[0] + x * scale * 2;
            const drawY = this.center[1] + y * scale * 2;
            ctx.beginPath();
            ctx.arc(drawX, drawY, this.radius, 0, 2 * Math.PI);
            ctx.fillStyle = this.getColor();
            ctx.fill();
        }
        return this.status < 1;
    }

    getColor() {
        const fadeFactor = Math.max(0, 1 - (this.status - 0.7) / 0.3);
        return `rgba(${parseInt(this.color.slice(1, 3), 16) * fadeFactor}, 
                      ${parseInt(this.color.slice(3, 5), 16) * fadeFactor}, 
                      ${parseInt(this.color.slice(5, 7), 16) * fadeFactor}, 
                      ${fadeFactor})`;
    }
}

function heartFunction(t, scale = IMAGE_ENLARGE) {
    const x = 16 * Math.pow(Math.sin(t), 3) * scale + CANVAS_CENTER_X;
    const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * scale + CANVAS_CENTER_Y;
    return [x, y];
}

class Heart {
    constructor() {
        this.points = [];
        this.edgePoints = [];
        this.centerPoints = [];
        for (let i = 0; i < 2000; i++) {
            const t = Math.random() * 2 * Math.PI;
            this.points.push(heartFunction(t));
        }
        for (const [x, y] of this.points) {
            for (let i = 0; i < 3; i++) {
                const dx = x + Math.random() * 20 - 10;
                const dy = y + Math.random() * 20 - 10;
                this.edgePoints.push([dx, dy]);
            }
        }
    }

    render(frame) {
        ctx.fillStyle = HEART_COLOR;
        for (const [x, y] of this.points) {
            ctx.fillRect(x, y, 2, 2);
        }
        if (frame % 2 === 0) {
            for (const [x, y] of this.edgePoints) {
                ctx.fillRect(x, y, 1, 1);
            }
        }
    }
}

const fireworks = [];
const heart = new Heart();

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (fireworks.length < 1) {
        fireworks.push(new Firework(`#${Math.floor(Math.random() * 16777215).toString(16)}`, Math.random() * 2 + 1.5, canvas.width, canvas.height));
    }
    heart.render(Date.now() % 20);
    for (let i = fireworks.length - 1; i >= 0; i--) {
        if (!fireworks[i].update()) {
            fireworks.splice(i, 1);
        }
    }
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
